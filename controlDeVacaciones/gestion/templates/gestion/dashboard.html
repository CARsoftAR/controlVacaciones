{% extends 'gestion/base.html' %}

{% block title %}Dashboard - Control de Vacaciones{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto">

    {% if es_manager_dashboard %}
    {# ============================================ #}
    {# DASHBOARD DE MANAGER #}
    {# ============================================ #}

    {% if not user.is_superuser %}
    <div class="lg:hidden block mb-12 border-b border-gray-200 dark:border-gray-700 pb-8">
        <!-- Banner de Usuario M√≥vil Suave -->
        <div class="mb-6 bg-slate-50 rounded-2xl p-6 border border-slate-200">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-full bg-gradient-to-tr from-blue-100 to-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-2xl shadow-sm border border-white">
                    {{ empleado.nombre|first|upper }}{{ empleado.apellido|first|upper }}
                </div>
                <div class="flex-1">
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Sesi√≥n activa</p>
                    <h2 class="text-slate-900 font-black text-xl">{{ empleado.nombre }} {{ empleado.apellido }}</h2>
                    <p class="text-slate-500 text-xs mt-1">
                        <i class="fas fa-briefcase text-indigo-400 mr-1"></i>
                        {% if empleado.es_manager %}Manager{% else %}Empleado{% endif %}
                    </p>
                </div>
            </div>
        </div>
        
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 px-2">Mi Resumen Personal</h2>
        
        <div class="grid grid-cols-1 gap-6">
             <!-- D√≠as Disponibles (Personal) -->
             <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 border-l-4 border-purple-500 relative overflow-hidden group">
                 <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full -mr-16 -mt-16"></div>
                 <div class="relative z-10 flex items-center justify-between">
                     <div>
                         <div class="text-5xl font-black text-gray-900 dark:text-white mb-2">{{ saldo_disponible_personal }}</div>
                         <div class="text-lg font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Mis D√≠as Disponibles</div>
                         <div class="text-sm text-gray-500 mt-1">Ciclo {{ current_year }}</div>
                     </div>
                     <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center shadow-lg">
                         <i class="fas fa-user-clock text-white text-3xl"></i>
                     </div>
                 </div>
             </div>
 
             <!-- Bot√≥n Gigante de Acci√≥n (Igual que empleados) -->
             <div>
                  <a href="{% url 'gestion:solicitar_mis_vacaciones' %}" 
                     class="group relative w-full h-[140px] bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-xl flex items-center justify-center overflow-hidden active:scale-95 transition-all">
                     
                     <div class="absolute inset-0 bg-white/10 group-hover:bg-transparent transition-colors"></div>
                     <div class="absolute -right-6 -bottom-6 opacity-20 transform rotate-12">
                         <i class="fas fa-paper-plane text-8xl text-white"></i>
                     </div>
                     
                     <div class="relative z-10 flex flex-col items-center">
                         <i class="fas fa-plus-circle text-4xl text-white mb-2 shadow-sm"></i>
                         <span class="text-2xl font-black text-white tracking-wide shadow-sm">PEDIR MIS VACACIONES</span>
                     </div>
                  </a>
             </div>
        </div>
     </div>
    {% endif %}


    <!-- 
        SECCI√ìN DE GESTI√ìN DE EQUIPO (Manager Dashboard Original)
        OCULTA en m√≥viles por defecto para cumplir "Solo mostrar d√≠as y pedir",
        pero mostrada en Desktop.
        Se puede agregar un toggle si fuera necesario, pero la request fue "solo mostrarme..."
    -->
    <div class="hidden lg:block">
        
        <!-- Welcome Section Compacta y Refinada -->
        <div class="mb-8 animate-fade-in group">
            <div class="bg-white rounded-3xl p-8 text-slate-800 border-2 border-slate-50 shadow-xl shadow-slate-200/40 relative overflow-hidden">
                <!-- Decoraci√≥n sutil -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-50/40 rounded-full -mr-32 -mt-32 blur-3xl"></div>
                
                <div class="relative z-10 flex flex-col lg:flex-row items-center justify-between gap-6">
                    <div class="flex-1">
                        <div class="inline-flex items-center gap-2 bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-3">
                            Gesti√≥n Estrat√©gica
                        </div>
                        <h1 class="text-3xl font-black text-slate-900 mb-1 tracking-tight">
                            ¬°Bienvenido, <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-600">{{ empleado.nombre }}</span>! üëã
                        </h1>
                        <p class="text-sm text-slate-500 font-medium">
                            Panel de control - Ciclo {{ current_year }}
                        </p>

                        <!-- Info Chips integrados -->
                        <div class="flex flex-wrap gap-3 mt-5">
                            {% if proximo_festivo %}
                            <div class="bg-slate-50 border border-slate-100 rounded-2xl p-3 flex items-center gap-3 shadow-sm min-w-[220px] hover:bg-white hover:border-indigo-100 transition-all">
                                <div class="w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-500">
                                    <i class="fas fa-flag text-lg"></i>
                                </div>
                                <div>
                                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Pr√≥ximo Feriado</p>
                                    <p class="text-xs font-bold text-slate-800 truncate w-32" title="{{ proximo_festivo.descripcion }}">{{ proximo_festivo.descripcion }}</p>
                                    <p class="text-[9px] font-medium text-amber-600 mt-0.5">
                                        {{ proximo_festivo.fecha|date:"d M" }} ‚Ä¢ Faltan {{ proximo_festivo.dias_restantes }} d√≠as
                                    </p>
                                </div>
                            </div>
                            {% endif %}

                            {% if mi_proxima_vacacion and not user.is_superuser %}
                            <div class="bg-slate-50 border border-slate-100 rounded-2xl p-3 flex items-center gap-3 shadow-sm min-w-[220px] hover:bg-white hover:border-indigo-100 transition-all">
                                <div class="w-10 h-10 rounded-xl bg-indigo-50 flex items-center justify-center text-indigo-500">
                                    <i class="fas fa-plane text-lg"></i>
                                </div>
                                <div>
                                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Tu Descanso</p>
                                    <p class="text-xs font-bold text-slate-800">{{ mi_proxima_vacacion.fecha_inicio|date:"d M, Y" }}</p>
                                    <p class="text-[9px] font-medium text-indigo-600 mt-0.5">
                                        Faltan {{ dias_para_vacacion }} d√≠as
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if not user.is_superuser %}
                    <div class="flex items-center gap-6">
                        <div class="bg-slate-50 p-5 rounded-3xl border border-slate-100 text-center min-w-[140px] shadow-inner">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">D√≠as Disponibles</p>
                            <p class="text-4xl font-black text-slate-900">{{ saldo_disponible_personal|default:"0" }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Team KPI Cards con animaciones y progreso -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">

            <!-- Total Empleados -->
            <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 border-l-4 border-blue-500 hover:shadow-2xl transition-all duration-300 relative group overflow-hidden"
                data-tooltip="Total de personal activo en el sistema">
                <!-- ... (contenido original) ... -->
                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fas fa-users text-white text-3xl"></i>
                        </div>
                        <div class="text-3xl font-bold text-blue-500 opacity-20"><i class="fas fa-chart-line"></i></div>
                    </div>
                    <div class="text-5xl font-black text-gray-900 dark:text-white mb-3 counter" data-target="{{ total_empleados }}">0</div>
                    <div class="text-base font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Empleados Totales</div>
                    <div class="text-sm text-gray-500 dark:text-gray-500 mt-3 flex items-center gap-2">
                        <i class="fas fa-circle text-green-500 text-xs animate-pulse"></i> Personal activo
                    </div>
                </div>
            </div>

            <!-- Solicitudes Pendientes -->
            <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 border-l-4 border-orange-500 hover:shadow-2xl transition-all duration-300 relative group overflow-hidden"
                data-tooltip="Vacaciones pendientes de aprobaci√≥n">
                <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500/10 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fas fa-clock text-white text-3xl animate-pulse"></i>
                        </div>
                        <div class="text-3xl font-bold text-orange-500 opacity-20"><i class="fas fa-hourglass-half"></i></div>
                    </div>
                    <div class="text-5xl font-black text-gray-900 dark:text-white mb-3 counter" data-target="{{ solicitudes_pendientes }}">0</div>
                    <div class="text-base font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Solicitudes Pendientes</div>
                    <div class="text-sm text-gray-500 dark:text-gray-500 mt-3 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle text-orange-500 text-xs animate-bounce"></i> Requieren aprobaci√≥n
                    </div>
                </div>
            </div>

            <!-- D√≠as Disponibles del Equipo -->
            <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 border-l-4 border-green-500 hover:shadow-2xl transition-all duration-300 relative group overflow-hidden"
                data-tooltip="Suma total de saldos disponibles del equipo">
                <div class="absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fas fa-calendar-check text-white text-3xl"></i>
                        </div>
                        <div class="text-3xl font-bold text-green-500 opacity-20"><i class="fas fa-chart-pie"></i></div>
                    </div>
                    <div class="text-5xl font-black text-gray-900 dark:text-white mb-3 counter" data-target="{{ total_dias_equipo }}">0</div>
                    <div class="text-base font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">D√≠as del Equipo</div>
                     <div class="text-sm text-gray-500 dark:text-gray-500 mt-3 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500 text-xs"></i> Total disponibles
                    </div>
                </div>
            </div>

            <!-- Tus D√≠as Personales (Desktop Version) -->
            <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 border-l-4 border-purple-500 hover:shadow-2xl transition-all duration-300 relative group overflow-hidden"
                data-tooltip="Tu saldo personal de vacaciones">
                <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative z-10 text-center">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-400 to-purple-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fas fa-user-check text-white text-3xl"></i>
                        </div>
                        <a href="{% url 'gestion:solicitar_mis_vacaciones' %}" 
                           class="bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 text-xs font-bold px-3 py-1 rounded-full hover:bg-purple-200 transition-colors">
                            PEDIR LAS M√çAS
                        </a>
                    </div>
                    <div class="text-5xl font-black text-gray-900 dark:text-white mb-2 counter" data-target="{{ saldo_disponible_personal }}">0</div>
                    <div class="text-base font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Tus D√≠as</div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Gr√°ficos Interactivos (Solo escritorio) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <!-- Gr√°fico de Vacaciones por Mes (Saturaci√≥n) -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-blue-600 dark:text-blue-400 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Vacaciones por Mes</h3>
                </div>
                <div class="relative h-80">
                    <canvas id="vacacionesMesChart"></canvas>
                </div>
            </div>

            <!-- Gr√°fico de Estado de Solicitudes -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                        <i class="fas fa-chart-pie text-green-600 dark:text-green-400 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Estado de Solicitudes</h3>
                </div>
                <div class="relative h-80">
                    <canvas id="estadoChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Two Column Layout con mejoras -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">

            <!-- Vacaciones Pr√≥ximas con animaciones -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                        <i class="fas fa-calendar-days text-purple-600 dark:text-purple-400 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Vacaciones Pr√≥ximas</h3>
                    <span class="bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-200 text-xs font-bold px-2 py-1 rounded-full">
                        Pr√≥ximos 30 d√≠as
                    </span>
                </div>

                {% if vacaciones_proximas %}
                <div class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                    {% for vacacion in vacaciones_proximas %}
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 group hover:scale-[1.02] hover:shadow-md">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-blue-400 flex items-center justify-center text-white font-bold group-hover:scale-110 transition-transform">
                                {{ vacacion.empleado.nombre|first }}{{ vacacion.empleado.apellido|first }}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 dark:text-white">{{ vacacion.empleado.nombre }} {{ vacacion.empleado.apellido }}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-300">{{ vacacion.fecha_inicio|date:"d/m/Y" }} - {{ vacacion.fecha_fin|date:"d/m/Y" }}</p>
                            </div>
                        </div>

                        <div class="text-right">
                            <span class="text-sm font-bold text-purple-600 dark:text-purple-400">{{ vacacion.dias_solicitados }} d√≠as</span>
                            <div class="text-xs text-gray-500 mt-1">
                                {% widthratio vacacion.dias_restantes_para_inicio 1 1 %} d√≠as
                            </div>
                        </div>

                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                        <i class="fas fa-calendar-xmark text-gray-400 text-3xl"></i>
                    </div>
                    <p class="text-gray-500 dark:text-gray-400">No hay vacaciones programadas en los pr√≥ximos 30 d√≠as</p>
                </div>
                {% endif %}
            </div>

            <!-- Solicitudes Recientes con mejoras -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                        <i class="fas fa-list-check text-orange-600 dark:text-orange-400 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Solicitudes Pendientes</h3>
                    {% if ultimas_solicitudes %}
                    <span class="bg-orange-100 dark:bg-orange-900/50 text-orange-800 dark:text-orange-200 text-xs font-bold px-2 py-1 rounded-full animate-pulse">
                        {{ ultimas_solicitudes|length }} activas
                    </span>
                    {% endif %}
                </div>

                {% if ultimas_solicitudes %}
                <div class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                    {% for solicitud in ultimas_solicitudes %}
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-200 group hover:scale-[1.02] hover:shadow-md">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-red-400 flex items-center justify-center text-white font-bold group-hover:scale-110 transition-transform">
                                {{ solicitud.empleado.nombre|first }}{{ solicitud.empleado.apellido|first }}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-900 dark:text-white">{{ solicitud.empleado.nombre }} {{ solicitud.empleado.apellido }}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-300">{{ solicitud.fecha_inicio|date:"d/m/Y" }} - {{ solicitud.fecha_fin|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-bold text-orange-600 dark:text-orange-400">{{ solicitud.dias_solicitados }} d√≠as</span>
                            <span class="inline-block bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 text-xs font-bold px-3 py-1 rounded-full animate-pulse">
                                Pendiente
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-6 flex gap-3">
                    <a href="{% url 'gestion:historial_global' %}"
                        class="flex-1 block text-center bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-lg transition transform hover:scale-105">
                        <i class="fas fa-eye mr-2"></i>Ver Todas
                    </a>
                    <a href="{% url 'gestion:solicitar_vacaciones' %}"
                        class="flex-1 block text-center bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>Nueva Solicitud
                    </a>
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                        <i class="fas fa-check-circle text-green-500 text-3xl"></i>
                    </div>
                    <p class="text-gray-500 dark:text-gray-400 mb-4">¬°No hay solicitudes pendientes!</p>
                    <a href="{% url 'gestion:solicitar_vacaciones' %}"
                        class="inline-block bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-lg transition transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>Crear Solicitud
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Quick Actions con animaciones mejoradas (Mantenido visible, necesario para managers) -->
    <div class="mb-12 hidden lg:block">

        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 animate-slide-in-left">Acciones R√°pidas</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            <a href="{% url 'gestion:solicitar_vacaciones' %}"
                class="action-card group bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-2xl p-8 transition-all duration-300 border border-gray-100 dark:border-gray-700 hover:border-blue-300 transform hover:scale-105 hover:-translate-y-1">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                        <i class="fas fa-calendar-plus text-white text-3xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 transition-colors">Nueva Solicitud</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Registrar vacaciones</p>
                        <div class="mt-2 text-xs text-blue-500 font-semibold">
                            <i class="fas fa-arrow-right mr-1"></i>Acci√≥n r√°pida
                        </div>
                    </div>
                </div>
            </a>

            <a href="{% url 'gestion:calendario_global' %}"
                class="action-card group bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-2xl p-8 transition-all duration-300 border border-gray-100 dark:border-gray-700 hover:border-purple-300 transform hover:scale-105 hover:-translate-y-1">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                        <i class="fas fa-calendar-days text-white text-3xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-purple-600 transition-colors">Calendario</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Planificaci√≥n del equipo</p>
                        <div class="mt-2 text-xs text-purple-500 font-semibold">
                            <i class="fas fa-chart-gantt mr-1"></i>Vista global
                        </div>
                    </div>
                </div>
            </a>

            <a href="{% url 'gestion:gestion_empleados' %}"
                class="action-card group bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-2xl p-8 transition-all duration-300 border border-gray-100 dark:border-gray-700 hover:border-green-300 transform hover:scale-105 hover:-translate-y-1">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                        <i class="fas fa-users text-white text-3xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-green-600 transition-colors">Empleados</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Administrar personal</p>
                        <div class="mt-2 text-xs text-green-500 font-semibold">
                            <i class="fas fa-user-cog mr-1"></i>Gesti√≥n
                        </div>
                    </div>
                </div>
            </a>

        </div>
    </div>

    {% else %}
    {# ============================================ #}
    {# DASHBOARD DE EMPLEADO - Datos Personales CON MEJORAS #}
    {# ============================================ #}

    <!-- Welcome Section con animaci√≥n -->
    <div class="mb-10 animate-fade-in">
        <div class="bg-gradient-to-r from-green-600 via-blue-600 to-purple-600 rounded-3xl p-8 text-white shadow-2xl relative overflow-hidden">
            <!-- C√≠rculos decorativos -->
            <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"></div>
            <div class="absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full -ml-24 -mb-24"></div>

            <div class="relative z-10 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
                <div>
                    <!-- Banner de Usuario M√≥vil (Solo m√≥vil) -->
                    <div class="lg:hidden mb-4 flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white font-bold text-lg shadow-lg border-2 border-white/30">
                            {{ empleado.nombre|first|upper }}{{ empleado.apellido|first|upper }}
                        </div>
                        <div>
                            <p class="text-white/80 text-xs font-medium">Sesi√≥n activa</p>
                            <p class="text-white font-bold text-sm">{{ empleado.nombre }} {{ empleado.apellido }}</p>
                        </div>
                    </div>
                    
                    <h1 class="text-5xl font-extrabold mb-4 animate-slide-in-left">
                        ¬°Bienvenido, {{ empleado.nombre }}! üëã
                    </h1>
                    <p class="text-xl opacity-90 animate-slide-in-left animation-delay-200">
                        Resumen de tu informaci√≥n de vacaciones - Ciclo {{ current_year }}
                    </p>
                </div>

                <!-- Info Premium Cards -->
                <div class="flex flex-wrap gap-4 animate-slide-in-right">
                    {% if proximo_festivo %}
                    <div class="bg-white/20 backdrop-blur-md rounded-2xl p-4 border border-white/30 flex items-center gap-4 shadow-lg min-w-[200px]">
                        <div class="w-12 h-12 rounded-xl bg-orange-400/90 flex items-center justify-center text-white shadow-inner">
                            <i class="fas fa-flag text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-xs font-bold uppercase tracking-wider text-white/70">Pr√≥ximo Feriado</p>
                            <p class="text-sm font-black">{{ proximo_festivo.descripcion }}</p>
                            <p class="text-[10px] font-medium opacity-80 mt-1">
                                {{ proximo_festivo.fecha|date:"d M" }} ‚Ä¢ Falta{% if proximo_festivo.dias_restantes != 1 %}n{% endif %} <b>{{ proximo_festivo.dias_restantes }}</b> d{% if proximo_festivo.dias_restantes != 1 %}√≠as{% else %}√≠a{% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}

                    {% if mi_proxima_vacacion %}
                    <div class="bg-white/20 backdrop-blur-md rounded-2xl p-4 border border-white/30 flex items-center gap-4 shadow-lg min-w-[200px]">
                        <div class="w-12 h-12 rounded-xl bg-blue-400/90 flex items-center justify-center text-white shadow-inner animate-pulse">
                            <i class="fas fa-plane text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-xs font-bold uppercase tracking-wider text-white/70">Tus Vacaciones</p>
                            <p class="text-sm font-black">{{ mi_proxima_vacacion.fecha_inicio|date:"d/m/Y" }}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-[10px] font-medium opacity-80">Falta{% if dias_para_vacacion != 1 %}n{% endif %} <b>{{ dias_para_vacacion }}</b> d{% if dias_para_vacacion != 1 %}√≠as{% else %}√≠a{% endif %}</span>
                                <a href="{% url 'gestion:exportar_notificacion_ics' mi_proxima_vacacion.id %}" class="bg-white text-blue-600 rounded px-1 text-[9px] font-bold hover:bg-blue-50 transition-colors">
                                    <i class="fas fa-calendar-plus mr-1"></i>CALENDARIO
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n Simplificada para M√≥viles (y Desktop) -->
    
    <!-- KPI Principal: D√≠as Disponibles -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">

        <!-- D√≠as Disponibles -->
        <div class="kpi-card bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-6 border-l-8 border-blue-500 hover:shadow-2xl transition-all duration-300 relative group overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full -mr-16 -mt-16 group-hover:scale-125 transition-transform duration-700"></div>
            <div class="relative z-10 flex flex-col items-start">
                <div class="flex items-center justify-between w-full mb-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-calendar-check text-white text-2xl"></i>
                    </div>
                    <div class="text-xs font-bold text-blue-500 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-full">
                        CICLO {{ current_year }}
                    </div>
                </div>
                <div class="text-6xl font-black text-gray-900 dark:text-white mb-1 counter" data-target="{{ saldo_disponible }}">0</div>
                <div class="text-base font-bold text-gray-600 dark:text-gray-400 uppercase tracking-widest">D√≠as Disponibles</div>
            </div>
        </div>

        <div class="flex flex-col justify-center">
             <a href="{% url 'gestion:solicitar_mis_vacaciones' %}" 
                class="group relative w-full h-full min-h-[150px] bg-gradient-to-r from-green-500 to-emerald-600 rounded-3xl shadow-2xl flex items-center justify-center overflow-hidden hover:scale-[1.02] active:scale-95 transition-all duration-300">
                
                <div class="absolute inset-0 bg-white/10 group-hover:bg-transparent transition-colors"></div>
                <div class="absolute -right-8 -bottom-8 opacity-20 transform rotate-12 group-hover:scale-125 group-hover:rotate-45 transition-transform duration-700">
                    <i class="fas fa-paper-plane text-[8rem] text-white"></i>
                </div>
                
                <div class="relative z-10 flex flex-col items-center">
                    <div class="w-14 h-14 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center mb-3 group-hover:scale-110 transition-transform shadow-inner">
                        <i class="fas fa-plus text-2xl text-white"></i>
                    </div>
                    <span class="text-2xl font-black text-white tracking-tighter shadow-sm">PEDIR VACACIONES</span>
                    <span class="text-white/80 text-sm mt-1 font-medium tracking-wide">Click para comenzar</span>
                </div>
             </a>
        </div>
    </div>

    <!-- Otros KPIs (Ocultos en m√≥vil, visibles en Desktop) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12 hidden md:grid">

        <!-- Antig√ºedad -->
        <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-l-4 border-green-500">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center text-green-600">
                    <i class="fas fa-briefcase text-xl"></i>
                </div>
                <div>
                     <div class="text-2xl font-bold text-gray-900 dark:text-white">
                        <span class="counter" data-target="{% widthratio empleado.antiguedad_en_anos 1 1 %}">0</span> a√±os
                     </div>
                     <div class="text-xs text-gray-500 uppercase">Antig√ºedad</div>
                </div>
            </div>
        </div>

        <!-- Departamento -->
        <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
             <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center text-purple-600">
                    <i class="fas fa-building text-xl"></i>
                </div>
                <div>
                     <div class="text-xl font-bold text-gray-900 dark:text-white truncate max-w-[150px]">
                        {{ empleado.departamento.nombre|default:"-" }}
                     </div>
                     <div class="text-xs text-gray-500 uppercase">Departamento</div>
                </div>
            </div>
        </div>

        <!-- Estado -->
        <div class="kpi-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-l-4 border-orange-500">
             <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-orange-600">
                    <i class="fas fa-user-check text-xl"></i>
                </div>
                <div>
                     <div class="text-xl font-bold text-gray-900 dark:text-white">Activo</div>
                     <div class="text-xs text-gray-500 uppercase">Estado</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Acciones Secundarias (Historial, etc.) -->
    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Otras Acciones</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
        <a href="{% url 'gestion:historial_personal' %}" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow border border-gray-200 dark:border-gray-700 hover:border-blue-500 transition text-center group">
            <i class="fas fa-clock-rotate-left text-2xl text-blue-500 mb-2 group-hover:scale-110 transition-transform"></i>
            <div class="font-bold text-gray-700 dark:text-gray-300">Mis Solicitudes</div>
        </a>
        
     </div>

    <!-- Information Section con mejoras -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <!-- System Info con animaciones -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Informaci√≥n del Sistema</h3>
            </div>
            <div class="space-y-5">
                <div class="flex justify-between items-center py-4 border-b border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg px-4 transition-colors group">
                    <span class="text-base font-semibold text-gray-700 dark:text-gray-300 group-hover:text-blue-600 transition-colors">
                        <i class="fas fa-calendar-alt mr-2 text-blue-500"></i>Per√≠odo de Goce
                    </span>
                    <span class="text-base font-bold text-gray-900 dark:text-white bg-blue-100 dark:bg-blue-900/50 px-3 py-1 rounded-full">01/Oct - 30/Abr</span>
                </div>
                <div class="flex justify-between items-center py-4 border-b border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg px-4 transition-colors group">
                    <span class="text-base font-semibold text-gray-700 dark:text-gray-300 group-hover:text-green-600 transition-colors">
                        <i class="fas fa-calendar mr-2 text-green-500"></i>Ciclo Actual
                    </span>
                    <span class="text-base font-bold text-gray-900 dark:text-white bg-green-100 dark:bg-green-900/50 px-3 py-1 rounded-full">{% now "Y" %}</span>
                </div>
                <div class="flex justify-between items-center py-4 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg px-4 transition-colors group">
                    <span class="text-base font-semibold text-gray-700 dark:text-gray-300 group-hover:text-purple-600 transition-colors">
                        <i class="fas fa-balance-scale mr-2 text-purple-500"></i>C√°lculo de D√≠as
                    </span>
                    <span class="text-base font-bold text-gray-900 dark:text-white bg-purple-100 dark:bg-purple-900/50 px-3 py-1 rounded-full">LCT Argentina</span>
                </div>
            </div>
        </div>

        <!-- Quick Links con animaciones -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                    <i class="fas fa-link text-purple-600 dark:text-purple-400 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Enlaces √ötiles</h3>
            </div>
            <div class="space-y-3">
                <a href="{% url 'gestion:mi_perfil' %}"
                    class="flex items-center gap-4 p-5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all border border-transparent hover:border-gray-200 dark:hover:border-gray-600 group hover:scale-[1.02]">
                    <i class="fas fa-user-circle text-gray-400 text-2xl group-hover:text-blue-500 transition-colors"></i>
                    <span class="text-base font-semibold text-gray-700 dark:text-gray-300 group-hover:text-blue-600 transition-colors">Mi Perfil</span>
                    <i class="fas fa-arrow-right text-gray-400 group-hover:text-blue-500 transition-colors ml-auto"></i>
                </a>
                <a href="{% url 'logout' %}"
                    class="flex items-center gap-4 p-5 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 transition-all border border-transparent hover:border-red-200 dark:hover:border-red-800 group hover:scale-[1.02]">
                    <i class="fas fa-right-from-bracket text-red-400 text-2xl group-hover:text-red-600 transition-colors"></i>
                    <span class="text-base font-semibold text-red-700 dark:text-red-400 group-hover:text-red-600 transition-colors">Cerrar Sesi√≥n</span>
                    <i class="fas fa-arrow-right text-red-400 group-hover:text-red-600 transition-colors ml-auto"></i>
                </a>
            </div>
        </div>

    </div>

    {% endif %}

</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ==========================================
    // ANIMACI√ìN DE CONTADORES
    // ==========================================
    const counters = document.querySelectorAll('.counter');
    const speed = 200; // Velocidad de animaci√≥n

    const animateCounter = (counter) => {
        const target = +counter.getAttribute('data-target');
        const increment = target / speed;
        
        const updateCount = () => {
            const count = +counter.innerText;
            
            if (count < target) {
                counter.innerText = Math.ceil(count + increment);
                setTimeout(updateCount, 10);
            } else {
                counter.innerText = target;
            }
        };
        
        updateCount();
    };

    // Intersection Observer para animar contadores cuando sean visibles
    const counterObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateCounter(entry.target);
                counterObserver.unobserve(entry.target);
            }
        });
    }, { threshold: 0.5 });

    counters.forEach(counter => {
        counterObserver.observe(counter);
    });

    // ==========================================
    // ANIMACIONES DE ENTRADA
    // ==========================================
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-fade-in');
                animationObserver.unobserve(entry.target);
            }
        });
    }, observerOptions);

    // Observar elementos para animaci√≥n
    document.querySelectorAll('.kpi-card, .action-card').forEach(el => {
        animationObserver.observe(el);
    });

    // ==========================================
    // EFECTOS HOVER ADICIONALES
    // ==========================================
    document.querySelectorAll('.kpi-card, .action-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
});
</script>

<style>
/* ==========================================
    ESTILOS ADICIONALES PARA ANIMACIONES
    ========================================== */
@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.animate-slide-in-left {
    animation: slideInLeft 0.8s ease-out;
}

.animate-slide-in-right {
    animation: slideInRight 0.8s ease-out;
}

.animation-delay-200 {
    animation-delay: 200ms;
}

/* Custom scrollbar */
.custom-scrollbar::-webkit-scrollbar {
    width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Dark mode scrollbar */
.dark .custom-scrollbar::-webkit-scrollbar-track {
    background: #374151;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #6b7280;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
}

/* Efectos de hover mejorados */
.kpi-card, .action-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.kpi-card:hover, .action-card:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* Loading skeleton animation */
@keyframes shimmer {
    0% {
        background-position: -1000px 0;
    }
    100% {
        background-position: 1000px 0;
    }
}

.skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 1000px 100%;
    animation: shimmer 2s infinite;
}

/* Mejorar visibilidad de tooltips */
[data-tooltip]:hover::before {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(-8px);
    transition: all 0.3s ease;
}

[data-tooltip]:hover::after {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(8px);
    transition: all 0.3s ease;
}
</style>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if es_manager_dashboard %}
    
    // --- Gr√°fico 1: Vacaciones por Mes (Bar Chart) ---
    const ctxMeses = document.getElementById('vacacionesMesChart').getContext('2d');
    new Chart(ctxMeses, {
        type: 'bar',
        data: {
            labels: {{ chart_meses_labels|safe }},
            datasets: [{
                label: 'Vacaciones Aprobadas',
                data: {{ chart_meses_data|safe }},
                backgroundColor: 'rgba(59, 130, 246, 0.6)', // Blue-500
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 1,
                borderRadius: 5,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { precision: 0 }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });

    // --- Gr√°fico 2: Estado de Solicitudes (Doughnut Chart) ---
    const ctxEstados = document.getElementById('estadoChart').getContext('2d');
    
    // Datos y Colores
    const estadosLabels = {{ chart_estados_labels|safe }};
    const estadosData = {{ chart_estados_data|safe }};
    
    // Mapeo de colores seg√∫n estado
    const colorMap = {
        'Aprobadas': 'rgba(16, 185, 129, 0.8)', // Green-500
        'Pendientes': 'rgba(245, 158, 11, 0.8)', // Amber-500
        'Rechazadas': 'rgba(239, 68, 68, 0.8)'   // Red-500
    };
    const bgColors = estadosLabels.map(label => colorMap[label] || '#cbd5e1');

    new Chart(ctxEstados, {
        type: 'doughnut',
        data: {
            labels: estadosLabels,
            datasets: [{
                data: estadosData,
                backgroundColor: bgColors,
                borderWidth: 0,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: { size: 12 },
                        usePointStyle: true
                    }
                }
            },
            cutout: '70%' // Hace el anillo m√°s fino
        }
    });

    {% endif %}
});
</script>
{% endblock %}